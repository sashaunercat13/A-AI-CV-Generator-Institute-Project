Search As screen:
    OnVisible: |-
        =// Dummy list of selected emails
        Clear(SelectedCVsEmails);
        ClearCollect(
            SelectedCVsEmails,
            {Email: "sasha.unercat@capgemini.com"},
            {Email: "blair.welsh@capgemini.com"}
        );
        
        
        Clear(FinalFilteredCVs);
        Collect(FinalFilteredCVs, 'CV Generator');
        
        // Set checkboxes
        Set(BPSScheckedSearch, false);
        Set(SCcheckedSearch, false);
        
        // Set filter variables
        Set(varIsSkillsEmpty, true);
        Set(varIsQualificationsEmpty, true);
        Set(varIsRoleEmpty, true);
        Set(varIsCapabilityEmpty, true);
        Set(varIsHubsEmpty, true);
        Set(varIsClientEmpty, true);
        Set(varIsIndustryEmpty, true);
        Set(varSCcheckedSearchEmpty, true);
        Set(varBPSScheckedSearchEmpty, true);
        // Additional conditions can be set similarly
        
        Set(allFiltersEmpty, (varIsSkillsEmpty
            && varIsQualificationsEmpty
            && varIsRoleEmpty
            && varIsCapabilityEmpty
            && varIsHubsEmpty
            && varIsClientEmpty
            && varIsIndustryEmpty
            && varBPSScheckedSearchEmpty
            && varSCcheckedSearchEmpty
            )
        );

    ButtonBackgroundLeftPanelSearch As button:
        DisabledBorderColor: =RGBA(51, 51, 51, 1)
        DisabledColor: =RGBA(51, 51, 51, 1)
        Fill: =RGBA(39, 41, 54, 1)
        Height: =640
        HoverBorderColor: =
        HoverColor: =RGBA(51, 51, 51, 1)
        HoverFill: =
        OnSelect: =
        PressedBorderColor: =
        PressedColor: =RGBA(51, 51, 51, 1)
        PressedFill: =
        Text: =""
        Width: =367
        X: =50
        Y: =106
        ZIndex: =1

    GalleryFilteredCVs As gallery.galleryVertical:
        BorderThickness: =2
        DelayItemLoading: =true
        DisplayMode: =DisplayMode.View
        Height: =545
        Items: =FinalFilteredCVs
        Layout: =Layout.Vertical
        LoadingSpinner: =LoadingSpinner.Data
        TemplateFill: =RGBA(0, 112, 173, 0)
        TemplatePadding: =2
        TemplateSize: =263
        Width: =857
        WrapCount: =4
        X: =468
        Y: =134
        ZIndex: =1

        ImageCandidateProfilePic As image:
            Height: =110
            Image: =ThisItem.Photo
            ImagePosition: =ImagePosition.Fill
            OnSelect: =Select(Parent)
            PaddingBottom: |
                =0
            RadiusBottomLeft: =55
            RadiusBottomRight: =55
            RadiusTopLeft: =55
            RadiusTopRight: =55
            Width: =110
            X: =50
            Y: =36
            ZIndex: =1

        "'Label - CandidateName' As label":
            Align: =Align.Center
            Font: =Font.Verdana
            FontWeight: =FontWeight.Semibold
            Height: =25
            OnSelect: =Select(Parent)
            PaddingBottom: =0
            PaddingLeft: =0
            PaddingRight: =0
            PaddingTop: =0
            Size: =13
            Text: |-
                =ThisItem.'First Name' & " " &
                ThisItem.'Last Name'
            VerticalAlign: =VerticalAlign.Top
            Width: =207
            X: =1
            Y: =11
            ZIndex: =2

        "'Label - CandidateGrade' As label":
            Align: =Align.Center
            Font: =Font.Verdana
            FontWeight: =If(ThisItem.IsSelected, FontWeight.Semibold, FontWeight.Normal)
            Height: =21
            OnSelect: =Select(Parent)
            PaddingBottom: =0
            PaddingLeft: =0
            PaddingRight: =0
            PaddingTop: =0
            Size: =11
            Text: =ThisItem.Grade
            VerticalAlign: =VerticalAlign.Top
            Width: =176
            X: =16
            Y: =157
            ZIndex: =3

        "'Label - CandidateCapability' As label":
            Align: =Align.Center
            Font: =Font.Verdana
            Height: =37
            OnSelect: =Select(Parent)
            Size: =10
            Text: =ThisItem.Capability & " - "
            Width: =191
            X: =9
            Y: =178
            ZIndex: =4

        "'Label - CandidateHub' As label":
            Align: =Align.Center
            Font: =Font.Verdana
            Height: =41
            OnSelect: =Select(Parent)
            Size: =10
            Text: =ThisItem.Hub
            Width: =191
            X: =9
            Y: =197
            ZIndex: =5

    RectangleBackgroundTopSearch As rectangle:
        Fill: =RGBA(39, 41, 54, 1)
        Height: =96
        Width: =1366
        ZIndex: =2

    "'Label - SearchTitle' As label":
        Color: =RGBA(255, 255, 255, 1)
        Font: =Font.Verdana
        FontWeight: =FontWeight.Semibold
        Height: =43
        Size: =24
        Text: ="Search CVs"
        Width: =312
        X: =98
        Y: =26
        ZIndex: =3

    ButtonSearch As button:
        OnSelect: |
            =Clear(FinalFilteredCVs); // Clear the collection to start fresh
            
            Clear(FilteredEmailsForClient); // Clear the collection which filters on Client
            Clear(FilteredClientsInIndustries); // Clear the collection which finds Clients associated with selected industry
            Clear(FilteredClientsInProjects); // Cleawr the collection which finds the CVs which have those Clients
            
            // Generate a collection of emails which have projects with the selected clients
            ClearCollect(
                FilteredEmailsForClient,
                Filter(
                    'CV Generator - Project Experience',
                    'Project Client' in ComboBoxClientFilter.SelectedItems
                ).Email
            );
            
            //Collect the clients associated with these industries into a collection.
            ClearCollect(
                FilteredClientsInIndustries,
                Filter(
                    'CV Generator - Client/Industry',
                    Industry in ComboBoxIndustryFilter.SelectedItems.Value
                ).Client
            );
            
            // Collect the emails of users who worked on a project with these clients
            ClearCollect(
                FilteredClientsInProjects,
                Filter(
                    'CV Generator - Project Experience',
                    'Project Client' in FilteredClientsInIndustries
                )
            );
            
            /* Define variables for conditions
            Set(varIsSkillsEmpty, IsEmpty(ComboBoxSkillSearch.SelectedItems));
            Set(varIsQualificationsEmpty, IsEmpty(ComboBoxQualSearch.SelectedItems));
            Set(varIsRoleEmpty, IsEmpty(ComboBoxRole.SelectedItems));
            Set(varIsCapabilityEmpty, IsEmpty(ComboBoxCapabilitySearch.SelectedItems));
            Set(varIsRadioHubsEmpty, Len(RadioHubsSearch.SelectedText.Value) = 0);
            Set(varIsClientEmpty, IsEmpty(ComboBoxClient.SelectedItems));
            Set(varIsIndustryEmpty, IsEmpty(ComboBoxIndustry.SelectedItems));
            // Additional conditions can be set similarly
            */
            
            // One button to filter them all
            Set(allFiltersEmpty, (varIsSkillsEmpty
                && varIsQualificationsEmpty
                && varIsRoleEmpty
                && varIsCapabilityEmpty
                && varIsHubsEmpty
                && varIsClientEmpty
                && varIsIndustryEmpty
                && varBPSScheckedSearchEmpty
                && varSCcheckedSearchEmpty
                )
            );
            /*
                varIsSkillsEmpty
                && varIsQualificationsEmpty
                && varIsRoleEmpty
                && !SCcheckedSearch
                && !BPSScheckedSearch
                && varIsCapabilityEmpty
                && varIsRadioHubsEmpty,
            */
            // Conditional logic to handle both skills and qualifications
            If(
                allFiltersEmpty,
                Collect(FinalFilteredCVs, 'CV Generator'),
                Collect(
                    FinalFilteredCVs,
                    Filter(
                        'CV Generator',
                        // Client
                        (varIsClientEmpty || Email in FilteredEmailsForClient),
                        // industry
                        (varIsIndustryEmpty || Email in FilteredClientsInProjects.Email),
                        // Skill filter - ony apply if there are selected skills
                        (varIsSkillsEmpty || 
                            CountIf(
                                ComboBoxSkillFilter.SelectedItems,
                                !IsBlank(Find(Text(Value), SkillsString))
                            ) > 0),
                        // Qualification filter - only apply if there are selected qualifications
                        (varIsQualificationsEmpty || 
                            CountIf(
                                ComboBoxQualFilter.SelectedItems,
                                !IsBlank(Find(Text(Value), QualificationsString))
                            ) > 0),
                        // Role Title filter - only apply if role title selected
                        (varIsRoleEmpty || Grade in ComboBoxGradeFilter.SelectedItems),
                        // Apply Security Clearance SC filter based on checkbox
                        (varBPSScheckedSearchEmpty || (!varBPSScheckedSearchEmpty && 'Security Clearance BPSS')),
                        // Apply Security Clearance BPSS filter based on checkbox
                        (varSCcheckedSearchEmpty || (!varSCcheckedSearchEmpty && 'Security Clearance SC')),
                        (varIsCapabilityEmpty || (Capability = ComboBoxCapabilityFilter.Selected.Value)),
                        //Hub = RadioHubsSearch.SelectedText.Value
                        (varIsHubsEmpty || (Hub = ComboBoxHubsFilter.Selected.Value))
                    )
                )
            );
        Text: |-
            ="Search
            "
        X: =155
        Y: =699
        ZIndex: =9

    Icon5_3 As icon.Search:
        Color: =RGBA(255, 255, 255, 1)
        Height: =72
        Icon: =Icon.Search
        Width: =53
        X: =34
        Y: =12
        ZIndex: =14

    GroupSecurityClearanceFilter As group:
        Height: =5
        Width: =5
        X: =40
        Y: =60
        ZIndex: =19

        CheckboxBPSSSearch As checkbox:
            CheckboxSize: =30
            Color: =RGBA(255, 255, 255, 1)
            Height: =40
            OnCheck: =Set(varBPSScheckedSearchEmpty,false)
            OnUncheck: =Set(varBPSScheckedSearchEmpty,true)
            Text: ="BPSS"
            Width: =121
            X: =65
            Y: =651
            ZIndex: =12

        CheckboxSCSearch As checkbox:
            CheckboxSize: =30
            Color: =RGBA(255, 255, 255, 1)
            Height: =40
            OnCheck: =Set(varSCcheckedSearchEmpty,false)
            OnUncheck: =Set(varSCcheckedSearchEmpty,true)
            Text: ="SC"
            Width: =121
            X: =195
            Y: =651
            ZIndex: =13

    ButtonViewSelected As button:
        OnSelect: |-
            =//ClickabuttoninPowerAppstosendanemail.Run()
            Navigate('View Selected CVs')
        Text: ="View Selected"
        X: =480
        Y: =706
        ZIndex: =51

    "'GroupFilterFields&Titles' As group":
        Height: =5
        Width: =5
        X: =40
        Y: =40
        ZIndex: =52

        ComboBoxSkillFilter As combobox:
            DisplayFields: =["Value"]
            Height: =35
            InputTextPlaceholder: =
            Items: =Skills
            OnChange: |-
                =// Set in the OnChange property of the ComboBox
                Set(varIsSkillsEmpty, IsEmpty(ComboBoxSkillFilter.SelectedItems));
            SearchFields: =["Value"]
            SearchItems: =Search(Skills,ComboBoxSkillFilter.SearchText,"Value")
            Width: =345
            X: =62
            Y: =456
            ZIndex: =5

        ComboBoxGradeFilter As combobox:
            DisplayFields: =["Value"]
            Height: =35
            InputTextPlaceholder: =
            Items: =["Associate Consultant","Consultant", "Senior Consultant"]
            OnChange: |-
                =// Set in the OnChange property of the ComboBox
                Set(varIsRoleEmpty, IsEmpty(ComboBoxGradeFilter.SelectedItems));
            SearchFields: =["Value"]
            SearchItems: =Search(["Associate Consultant","Consultant", "Senior Consultant"],ComboBoxGradeFilter.SearchText,"Value")
            SelectMultiple: =false
            Width: =345
            X: =62
            Y: =529
            ZIndex: =6

        LabelSkillsFilter As label:
            Color: =RGBA(255, 255, 255, 1)
            Font: =Font.Verdana
            FontWeight: =FontWeight.Semibold
            Height: =35
            Text: ="Skills"
            X: =62
            Y: =423
            ZIndex: =7

        LabelGradeFilter As label:
            Color: =RGBA(255, 255, 255, 1)
            Font: =Font.Verdana
            FontWeight: =FontWeight.Semibold
            Height: =35
            Text: ="Grade"
            X: =62
            Y: =497
            ZIndex: =8

        ComboBoxQualFilter As combobox:
            DisplayFields: =["Value"]
            Height: =35
            InputTextPlaceholder: =
            Items: =Qualifications
            OnChange: |-
                =// Set in the OnChange property of the ComboBox
                Set(varIsQualificationsEmpty, IsEmpty(ComboBoxQualFilter.SelectedItems));
            SearchFields: =["Value"]
            SearchItems: =Search(Qualifications,ComboBoxQualFilter.SearchText,"Value")
            Width: =345
            X: =62
            Y: =602
            ZIndex: =10

        LabelQualificationsFilter As label:
            Color: =RGBA(255, 255, 255, 1)
            Font: =Font.Verdana
            FontWeight: =FontWeight.Semibold
            Height: =35
            Text: ="Qualifications"
            X: =62
            Y: =571
            ZIndex: =11

        LabelCapabilityFilter As label:
            Color: =RGBA(255, 255, 255, 1)
            Font: =Font.Verdana
            FontWeight: =FontWeight.Semibold
            Height: =35
            Text: ="Capability"
            X: =62
            Y: =275
            ZIndex: =18

        ComboBoxClientFilter As combobox:
            DisplayFields: =["Client"]
            Height: =35
            InputTextPlaceholder: =
            Items: ='CV Generator - Client/Industry'.Client
            OnChange: |-
                =// Set in the OnChange property of the ComboBox
                Set(varIsClientEmpty, IsEmpty(ComboBoxClientFilter.SelectedItems));
            SearchFields: =["Client"]
            SearchItems: =Search('CV Generator - Client/Industry'.Client,ComboBoxClientFilter.SearchText,"Client")
            Width: =345
            X: =62
            Y: =237
            ZIndex: =24

        ComboBoxIndustryFilter As combobox:
            DisplayFields: =["Value"]
            Height: =37
            InputTextPlaceholder: =
            Items: |
                =["MALS", "CPRD", "Govt", "FS", "ET&U", "TMTS"]
            OnChange: |-
                =// Set in the OnChange property of the ComboBox
                Set(varIsIndustryEmpty, IsEmpty(ComboBoxIndustryFilter.SelectedItems));
            SearchFields: =["Value"]
            SearchItems: |-
                =Search(["MALS", "CPRD", "Govt", "FS", "ET&U", "TMTS"]
                ,ComboBoxIndustryFilter.SearchText,"Value")
            Width: =345
            X: =62
            Y: =162
            ZIndex: =26

        LabelClientFilter As label:
            Color: =RGBA(255, 255, 255, 1)
            Font: =Font.Verdana
            FontWeight: =FontWeight.Semibold
            Height: =35
            Text: ="Client"
            X: =62
            Y: =202
            ZIndex: =27

        LabelSectorFilter As label:
            Color: =RGBA(255, 255, 255, 1)
            Font: =Font.Verdana
            FontWeight: =FontWeight.Semibold
            Height: =35
            Text: ="Sector"
            X: =62
            Y: =127
            ZIndex: =28

        ComboBoxCapabilityFilter As combobox:
            DisplayFields: =["Value"]
            Height: =35
            InputTextPlaceholder: =
            Items: =["Data & AI Strategy", "Data & AI Innovation", "Data & AI Factory", "Data & AI Enablement"]
            OnChange: |-
                =// Set in the OnChange property of the ComboBox
                Set(varIsCapabilityEmpty, IsEmpty(ComboBoxCapabilityFilter.SelectedItems));
            SearchFields: =["Value"]
            SearchItems: =Search(["Data & AI Strategy", "Data & AI Innovation", "Data & AI Factory", "Data & AI Enablement"],ComboBoxCapabilityFilter.SearchText,"Value")
            SelectMultiple: =false
            Width: =345
            X: =62
            Y: =310
            ZIndex: =35

        ComboBoxHubsFilter As combobox:
            DisplayFields: =["Value"]
            Height: =35
            InputTextPlaceholder: =
            IsSearchable: =false
            Items: |-
                =/*
                If(
                    varIsCapabilityEmpty,
                    [],
                    LookUp(HubOptionSets, Capability = ComboBoxCapabilitySearch.Selected.Value).Options
                )
                */
                
                ["Data Strategy & Op Model", "Data Science Consulting", "Data Science Consulting", "AI Product Innovation", "Business Insights & Storytelling", "Data & AI Architecture", "Customer & Digital Analytics", "Operation & Enterprise Analytics"]
            OnChange: |-
                =// Set in the OnChange property of the ComboBox
                Set(varIsHubsEmpty, IsEmpty(ComboBoxHubsFilter.SelectedItems));
            SearchFields: =["Value"]
            SearchItems: |-
                =Search(/*
                If(
                    varIsCapabilityEmpty,
                    [],
                    LookUp(HubOptionSets, Capability = ComboBoxCapabilitySearch.Selected.Value).Options
                )
                */
                
                ["hubs"],ComboBoxHubsFilter.SearchText,"Value")
            SelectMultiple: =false
            Width: =345
            X: =62
            Y: =383
            ZIndex: =47

        LabelHubFilter As label:
            Color: =RGBA(255, 255, 255, 1)
            Font: =Font.Verdana
            FontWeight: =FontWeight.Semibold
            Height: =35
            Text: ="Hub"
            X: =62
            Y: =348
            ZIndex: =48

    ButtonBackSearch As button:
        OnSelect: =Back()
        Text: ="Back"
        X: =1165
        Y: =706
        ZIndex: =53

    IconHomeSearch As icon.Home:
        Color: =RGBA(255, 255, 255, 1)
        Height: =60
        Icon: =Icon.Home
        OnSelect: =Navigate(Home)
        Width: =52
        X: =1221
        Y: =30
        ZIndex: =54

    ImageCapIconSearch As image:
        Height: =60
        Image: ='Logo Blue'
        Width: =52
        X: =1288
        Y: =29
        ZIndex: =55

