"'Profesional Experience' As screen":
    OnVisible: |-
        =// set the button variable
        //UpdateContext({selectedItemId: Blank()});
        //Set(selectedButtonID, 0);
        
        // Initially set var to 0 so a new project is the default
        Set(varSelectedProjectID, 0);
        
        // Clear the collection
        Clear(ProjectsOfThisUser);
        
        // Create a collection of the user's projects
        Collect(ProjectsOfThisUser,
            Filter(
                'CV Generator - Project Experience',
                Email = User().Email
            )
        );
        
        //Collect(ProjectsOfThisUser, {ID: 0, 'Project Title': "New Project"});
        
        Set(varDatePicked, !IsBlank(ProjectEndDate_2.SelectedDate))

    RectangleBackgroundTopPE As rectangle:
        Fill: =RGBA(39, 41, 54, 1)
        Height: =116
        Width: =1366
        ZIndex: =1

    ImageCapIconPE As image:
        Height: =60
        Image: ='Logo Blue'
        Width: =52
        X: =1288
        Y: =29
        ZIndex: =2

    "'Label - TitleProfessionalExperience' As label":
        Color: =RGBA(255, 255, 255, 1)
        Font: =Font.Verdana
        FontWeight: =FontWeight.Semibold
        Height: =39
        Size: =24
        Text: ="Professional Experience"
        Width: =790
        X: =84
        Y: =37
        ZIndex: =3

    IconCheckPE As icon.CheckBadge:
        Color: =RGBA(255, 255, 255, 1)
        Icon: =Icon.CheckBadge
        X: =14
        Y: =27
        ZIndex: =4

    ButtonBackgroundLeftPanel As button:
        Fill: =RGBA(39, 41, 54, 1)
        Height: =562
        HoverBorderColor: =
        HoverFill: =
        OnSelect: =
        PressedBorderColor: =
        Text: =""
        Width: =327
        X: =50
        Y: =145
        ZIndex: =5

    "'Label - ProjectOverview' As label":
        Color: =RGBA(255, 255, 255, 1)
        Font: =Font.Verdana
        FontWeight: =FontWeight.Semibold
        Size: =18
        Text: ="Project Overview"
        Width: =257
        X: =64
        Y: =174
        ZIndex: =6

    "'Container - AllProjectExperienceInputFields' As groupContainer":
        DropShadow: =DropShadow.Regular
        Height: =562
        Width: =959
        X: =395
        Y: =145
        ZIndex: =16

        ComboBoxProjectManager As combobox:
            Default: |-
                =If(
                    varSelectedProjectID > 0,
                    LookUp(
                        'CV Generator - Project Experience',
                        ID = varSelectedProjectID,
                        {
                            Claims: Concatenate(
                                "i:0#.f|membership|",
                                User().Email
                            ),
                            Department: "",
                            DisplayName: "",
                            Email: "Hello",
                            JobTitle: "",
                            Picture: ""
                        }
                    ),
                    {
                        Claims: "",
                        Department: "",
                        DisplayName: "",
                        Email: "",
                        JobTitle: "",
                        Picture: ""
                    }
                )
                //Today()
            DefaultSelectedItems: |-
                =/*{
                        '@odata.type': "#Microsoft.Azure.Connectors.SharePoint.Client_Data",
                        Claims: 
                            User().Email
                        ,
                        DisplayName: User().FullName,
                        Email: User().Email
                    } 
                {
                
                      /*  '@odata.type': "#Microsoft.Azure.Connectors.SharePoint.'CV Generator'",
                
                        Claims: Concatenate(
                
                            "i:0#.f|membership|",
                
                            User().Email
                
                        ),
                
                        DisplayName: User().FullName,
                
                        Email: User().Email
                
                    } 
                    */
            DisplayFields: =["Claims"]
            Font: =Font.Verdana
            Height: =33
            InputTextPlaceholder: ="Please select your manager" 
            Items: =Choices([@'CV Generator - Project Experience'].'Microsoft Profile')
            SearchFields: =["Claims"]
            SearchItems: =Choices('CV Generator - Project Experience'.'Microsoft Profile',ComboBoxProjectManager.SearchText)
            SelectMultiple: |
                =false
            Template: =ListItemTemplate.Person
            Visible: |
                =true
            X: =34
            Y: =80
            ZIndex: =14

    ButtonSubmitProject As button:
        DisplayMode: |-
            =If(
                IsBlank('1ProjectTitle_2'.Text) Or 
                IsBlank(ComboBoxOneClient.SelectedItems) Or
                IsBlank(ComboBoxRole1.SelectedItems) Or 
                IsBlank(ComboBoxProjectManager.SelectedItems) Or 
                IsBlank(ProjectEndDate_2.SelectedDate) Or
                IsBlank('1ProjectStartDate_2'.SelectedDate) Or
                IsBlank('1ProjectDescription_2'.Text),
            
            	DisplayMode.Disabled, DisplayMode.Edit)
        Fill: =RGBA(39, 113, 194, 1)
        OnSelect: |
            =If(
                varSelectedProjectID = 0,
                // Creating a new record because varSelectedProjectID = 0
                Patch(
                    'CV Generator - Project Experience',
                    Defaults('CV Generator - Project Experience'),// Indicates a new record
                    {
                        Email: User().Email,
                        'Project Title': '1ProjectTitle_2'.Text,
                        'Project Client': ComboBoxOneClient.Selected.Client,
                        'Project Role': ComboBoxRole1.Selected.Value,
                        'Start Date': '1ProjectStartDate_2'.SelectedDate,
                        //'Project Manager': ComboBoxProjectManager.Selected.Item, 
                        'Project Description': '1ProjectDescription_2'.Text,
                        'Microsoft Profile': {
                            Claims: Concatenate(
                                "i:0#.f|membership|",
                                User().Email
                            ),
                            Department: "",
                            DisplayName: User().FullName,
                            Email: User().Email,
                            JobTitle: "",
                            Picture: ""
                        }
                    }
                ),
                // Updating an existing record because varSelectedProjectID > 0
                Patch(
                    'CV Generator - Project Experience',
                    LookUp(
                        'CV Generator - Project Experience',
                        ID = varSelectedProjectID
                    ),
                    {
                        'Project Title': '1ProjectTitle_2'.Text,
                        'Project Client': ComboBoxOneClient.Selected.Client,
                        'Project Role': ComboBoxRole1.Selected.Value,
                        'Start Date': '1ProjectStartDate_2'.SelectedDate,
                        'Project Description': '1ProjectDescription_2'.Text,
                        'Microsoft Profile': {
                            Claims: Concatenate(
                                "i:0#.f|membership|",
                                User().Email
                            ),
                            Department: "",
                            DisplayName: User().FullName,
                            Email: User().Email,
                            JobTitle: "",
                            Picture: ""
                        }
                    }
                )
            );
            /*
            If (
                    !IsBlank('1ProjectEndDate_2'.SelectedDate),
                    Patch(
                        'CV Generator - Project Experience',
                        LookUp(
                            'CV Generator - Project Experience',
                            ID = varSelectedProjectID
                        ),
                        {'End Date': '1ProjectEndDate_2'.SelectedDate}
                    )
            );
            */
            // Refresh the List
            Refresh('CV Generator - Project Experience');
            // Add the new project to the list
            Clear(ProjectsOfThisUser);
            // Update the collection
            ClearCollect(
                ProjectsOfThisUser,
                Filter(
                    'CV Generator - Project Experience',
                    Email = User().Email
                )
            );
            //reset the form fields
            Reset('1ProjectTitle_2');
            Reset(ComboBoxRole1);
            //Reset('Dropdown3');
            Reset('1ProjectStartDate_2');
            Reset(ProjectEndDate_2);
            Reset('1ProjectDescription_2');
            Reset(ComboBoxOneClient);
        Text: ="Submit project"
        X: =395
        Y: =719
        ZIndex: =17

    GalleryProjectsDisplay As gallery.galleryVertical:
        DelayItemLoading: =true
        Height: =470
        Items: |-
            =ProjectsOfThisUser
            //Lookup('CV Generator - Project Experience', Email=User().Email);
        Layout: =Layout.Vertical
        LoadingSpinner: =LoadingSpinner.Data
        TemplateSize: =50
        Width: =336
        X: =78
        Y: =237
        ZIndex: =21

    "'Label - varSelectedProjectID (Hidden)' As label":
        Color: =RGBA(255, 255, 255, 1)
        Height: =36
        Size: =26
        Text: =varSelectedProjectID
        Visible: =false
        Width: =33
        X: =64
        Y: =663
        ZIndex: =22

    ButtonBackPE As button:
        Fill: =RGBA(39, 113, 194, 1)
        OnSelect: =Back()
        Text: ="Back"
        X: =14
        Y: =719
        ZIndex: =26

    ButtonCompleteCV As button:
        OnSelect: |-
            =// navigate to the success screen
            Navigate(Success, ScreenTransition.Fade)
        Text: ="Complete CV"
        X: =1180
        Y: =719
        ZIndex: =27

    IconHomePE As icon.Home:
        Color: =RGBA(255, 255, 255, 1)
        Height: =60
        Icon: =Icon.Home
        OnSelect: =Navigate(Home)
        Width: =52
        X: =1221
        Y: =30
        ZIndex: =30

    GroupNewProjectButton As group:
        Height: =5
        Width: =5
        X: =40
        Y: =40
        ZIndex: =30

        IconAdd As icon.Add:
            BorderColor: =RGBA(255, 255, 255, 1)
            Color: =RGBA(255, 255, 255, 1)
            FocusedBorderColor: =RGBA(255, 255, 255, 1)
            FocusedBorderThickness: =0
            Height: =35
            Icon: =Icon.Add
            OnSelect: |
                =// reset the current project button
                Set(varSelectedProjectID, 0);
                
                // set this is selected button for colour
                //Set(selectedButtonID, 0);
            Width: =35
            X: =324
            Y: =174
            ZIndex: =28

        "'Label - New' As label":
            Color: =RGBA(255, 255, 255, 1)
            OnSelect: |
                =// reset the current project button
                //Set(varSelectedProjectID, 0);
                
                // set this is selected button for colour
                //Set(selectedButtonID, 0);
            Size: =12
            Text: ="New"
            Width: =60
            X: =320
            Y: =197
            ZIndex: =29

